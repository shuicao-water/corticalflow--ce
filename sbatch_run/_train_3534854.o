/home_data/home/xiaoqin2025/.conda/envs/Surf/bin/python
[2026-01-20 21:51:22,740][__main__][INFO] - Training Cortical Flow (PIAL MODEL)
Config:
user_config: /public_bme2/Share200T/caoshui2024/Project2_Deeplearning/CorticalFlow++/corticalflow/resources/config_samples/config_5T/CFPP_train_lh_5T_outer.yaml
dataset:
  path: <path_to_preprop_dataset>
  split_file: <CFPP_ROOT_DIR>/resources/ADNI_SPLIT.csv
  train_split_name: train
  val_split_name: valid
  surface_name: lh_outer
  hemisphere: lh
  surf_type: outer
  dataset_path: /public_bme2/bme-dgshen/caoshui2024/JM-pipeline-original/Step04_sMRI_Signal_Surfaces
  datasplit_csv: /public_bme2/Share200T/caoshui2024/Project2_Deeplearning/CotexODE/code/CortexODE-ce/data/subject_split_original.csv
trainer:
  img_batch_size: 3
  points_per_image: 150000
  train_log_interval: 2
  checkpoint_interval: 2
  evaluate_interval: 2
  device: cuda:0
  resume: null
  debug: false
pial_model:
  number_of_iterations:
  - 4
  - 4
  - 4
  nb_features:
  - - - 16
      - 32
    - - 32
      - 32
      - 16
      - 16
  - - - 16
      - 32
    - - 32
      - 32
      - 16
      - 16
  - - - 16
      - 32
    - - 32
      - 32
      - 16
      - 16
  integration_method: RK4
  integration_steps: 2
  share_flows: true
white_model:
  model_checkpoint: <CFPP_ROOT_DIR>/resources/trained_models/CFPP_LEFT_WHITE.pth
  nb_features:
  - - - 16
      - 32
      - 32
      - 32
    - - 32
      - 32
      - 32
      - 32
      - 32
      - 16
      - 16
  - - - 16
      - 32
    - - 32
      - 32
      - 16
      - 16
  - - - 16
      - 32
    - - 32
      - 32
      - 16
      - 16
  template: <CFPP_ROOT_DIR>/resources/smooth_templates/lh_white_smooth_380k.obj
  integration_method: RK4
  integration_steps: 30
  share_flows: true
objective:
  chamffer_weight:
  - 1.0
  - 1.0
  - 1.0
  edge_loss_weight:
  - 1.0
  - 1.0
  - 1.0
optimizer:
  name: Adam
  lr:
  - 0.0001
  - 0.0001
  - 0.0001
outputs:
  output_dir: /public_bme2/bme-dgshen/caoshui2024/DP_Project/CorticalFlow++/exp/exp_lh_outer

[2026-01-20 21:51:23,634][__main__][INFO] - 188 subjects loaded for training
[2026-01-20 21:51:23,827][__main__][INFO] - 41 subjects loaded for validation
[2026-01-20 21:51:24,129][__main__][INFO] - Learnable Pial Model setup:
CorticalFlow(
  (deform_blocks): ModuleList(
    (0): DeformationBlock(
      (encoder): Unet(
        (downarm): ModuleList(
          (0): ConvBlock(
            (main): Conv3d(1, 16, kernel_size=(3, 3, 3), stride=(2, 2, 2), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
          (1): ConvBlock(
            (main): Conv3d(16, 32, kernel_size=(3, 3, 3), stride=(2, 2, 2), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
        )
        (uparm): ModuleList(
          (0): Sequential(
            (0): ConvBlock(
              (main): Conv3d(32, 32, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
              (activation): LeakyReLU(negative_slope=0.2)
            )
            (1): Upsample(scale_factor=2.0, mode='nearest')
          )
          (1): Sequential(
            (0): ConvBlock(
              (main): Conv3d(48, 32, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
              (activation): LeakyReLU(negative_slope=0.2)
            )
            (1): Upsample(scale_factor=2.0, mode='nearest')
          )
        )
        (extras): ModuleList(
          (0): ConvBlock(
            (main): Conv3d(33, 16, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
          (1): ConvBlock(
            (main): Conv3d(16, 16, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
        )
      )
      (flow): Conv3d(16, 3, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
      (deformer): DiffeoMeshDeformer(
        (integrate): IntegratePointWiseRK4(
          (interpolator): PointPooling()
        )
      )
    )
    (1): DeformationBlock(
      (encoder): Unet(
        (downarm): ModuleList(
          (0): ConvBlock(
            (main): Conv3d(4, 16, kernel_size=(3, 3, 3), stride=(2, 2, 2), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
          (1): ConvBlock(
            (main): Conv3d(16, 32, kernel_size=(3, 3, 3), stride=(2, 2, 2), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
        )
        (uparm): ModuleList(
          (0): Sequential(
            (0): ConvBlock(
              (main): Conv3d(32, 32, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
              (activation): LeakyReLU(negative_slope=0.2)
            )
            (1): Upsample(scale_factor=2.0, mode='nearest')
          )
          (1): Sequential(
            (0): ConvBlock(
              (main): Conv3d(48, 32, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
              (activation): LeakyReLU(negative_slope=0.2)
            )
            (1): Upsample(scale_factor=2.0, mode='nearest')
          )
        )
        (extras): ModuleList(
          (0): ConvBlock(
            (main): Conv3d(36, 16, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
          (1): ConvBlock(
            (main): Conv3d(16, 16, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
        )
      )
      (flow): Conv3d(16, 3, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
      (deformer): DiffeoMeshDeformer(
        (integrate): IntegratePointWiseRK4(
          (interpolator): PointPooling()
        )
      )
    )
    (2): DeformationBlock(
      (encoder): Unet(
        (downarm): ModuleList(
          (0): ConvBlock(
            (main): Conv3d(7, 16, kernel_size=(3, 3, 3), stride=(2, 2, 2), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
          (1): ConvBlock(
            (main): Conv3d(16, 32, kernel_size=(3, 3, 3), stride=(2, 2, 2), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
        )
        (uparm): ModuleList(
          (0): Sequential(
            (0): ConvBlock(
              (main): Conv3d(32, 32, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
              (activation): LeakyReLU(negative_slope=0.2)
            )
            (1): Upsample(scale_factor=2.0, mode='nearest')
          )
          (1): Sequential(
            (0): ConvBlock(
              (main): Conv3d(48, 32, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
              (activation): LeakyReLU(negative_slope=0.2)
            )
            (1): Upsample(scale_factor=2.0, mode='nearest')
          )
        )
        (extras): ModuleList(
          (0): ConvBlock(
            (main): Conv3d(39, 16, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
          (1): ConvBlock(
            (main): Conv3d(16, 16, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
        )
      )
      (flow): Conv3d(16, 3, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
      (deformer): DiffeoMeshDeformer(
        (integrate): IntegratePointWiseRK4(
          (interpolator): PointPooling()
        )
      )
    )
  )
)
[2026-01-20 21:51:24,140][__main__][INFO] - Tensorboard logs saved to /public_bme2/bme-dgshen/caoshui2024/DP_Project/CorticalFlow++/exp/exp_lh_outer/tb_logs
[2026-01-20 21:51:24,140][__main__][INFO] - Training deformation 0
[2026-01-20 21:51:24,141][__main__][INFO] - Train deform 0: number of learnable parameters: 105987/325737
[2026-01-20 21:51:24,142][__main__][INFO] - Train deform 0: Optimizer setup:
Adam (
Parameter Group 0
    amsgrad: False
    betas: (0.9, 0.999)
    capturable: False
    differentiable: False
    eps: 1e-08
    foreach: None
    fused: None
    lr: 0.0001
    maximize: False
    weight_decay: 0
)
[2026-01-20 21:51:24,142][__main__][INFO] - Starting train deformation 0 from 1 iterations with best validation loss of 3.4028234663852886e+38
[2026-01-20 21:51:55,914][__main__][INFO] - Training: deform=0, Ite=2, Losses=defaultdict(<class 'float'>, {'chamffer_points': 0.0006703743129037321, 'edge_loss': 0.00012168451576144435, 'loss': 0.0007920588250271976}), AvgIteTime=15.89 secs
[2026-01-20 21:51:55,917][__main__][INFO] - Evaluating...
[2026-01-20 21:55:14,364][__main__][INFO] - Evaluation: deform=0, Ite=2, Loss=defaultdict(<class 'float'>, {'chamffer_points': 0.00020519675681276655, 'edge_loss': 3.9926078099553e-05, 'loss': 0.00024512283526724433}), EvalTime=198.44 secs
[2026-01-20 21:55:14,454][__main__][INFO] - Best model found with chamffer_points=0.000205 !!! checkpoint to /public_bme2/bme-dgshen/caoshui2024/DP_Project/CorticalFlow++/exp/exp_lh_outer/best_model_DT0.pth
[2026-01-20 21:55:14,478][__main__][INFO] - checkpoint saved to /public_bme2/bme-dgshen/caoshui2024/DP_Project/CorticalFlow++/exp/exp_lh_outer/checkpoints/model_DT0_ite000002.pth
[2026-01-20 21:55:19,832][__main__][INFO] - Training: deform=0, Ite=4, Losses=defaultdict(<class 'float'>, {'chamffer_points': 0.0006449724023696035, 'edge_loss': 0.00012002762377960607, 'loss': 0.0007650000043213367}), AvgIteTime=101.95 secs
[2026-01-20 21:55:19,833][__main__][INFO] - Evaluating...
[2026-01-20 21:58:15,350][__main__][INFO] - Evaluation: deform=0, Ite=4, Loss=defaultdict(<class 'float'>, {'chamffer_points': 0.0002052282059860484, 'edge_loss': 3.9925650592677565e-05, 'loss': 0.00024515385853081216}), EvalTime=175.52 secs
[2026-01-20 21:58:15,377][__main__][INFO] - checkpoint saved to /public_bme2/bme-dgshen/caoshui2024/DP_Project/CorticalFlow++/exp/exp_lh_outer/checkpoints/model_DT0_ite000004.pth
[2026-01-20 21:58:15,377][__main__][INFO] - Training deformation 1
[2026-01-20 21:58:15,463][__main__][INFO] - Best wights for deformation 0 loaded from /public_bme2/bme-dgshen/caoshui2024/DP_Project/CorticalFlow++/exp/exp_lh_outer/best_model_DT0.pth
[2026-01-20 21:58:15,463][__main__][INFO] - Train deform 1: number of learnable parameters: 108579/325737
[2026-01-20 21:58:15,466][__main__][INFO] - Train deform 1: Optimizer setup:
Adam (
Parameter Group 0
    amsgrad: False
    betas: (0.9, 0.999)
    capturable: False
    differentiable: False
    eps: 1e-08
    foreach: None
    fused: None
    lr: 0.0001
    maximize: False
    weight_decay: 0
)
[2026-01-20 21:58:15,468][__main__][INFO] - Starting train deformation 1 from 1 iterations with best validation loss of 3.4028234663852886e+38
[2026-01-20 21:58:21,244][__main__][INFO] - Training: deform=1, Ite=2, Losses=defaultdict(<class 'float'>, {'chamffer_points': 0.0005657661822624505, 'edge_loss': 0.00011468162119854242, 'loss': 0.0006804477889090776}), AvgIteTime=2.89 secs
[2026-01-20 21:58:21,245][__main__][INFO] - Evaluating...
[2026-01-20 22:01:22,472][__main__][INFO] - Evaluation: deform=1, Ite=2, Loss=defaultdict(<class 'float'>, {'chamffer_points': 0.00020516213887121257, 'edge_loss': 3.992531909295017e-05, 'loss': 0.0002450874592063994}), EvalTime=181.23 secs
[2026-01-20 22:01:22,502][__main__][INFO] - Best model found with chamffer_points=0.000205 !!! checkpoint to /public_bme2/bme-dgshen/caoshui2024/DP_Project/CorticalFlow++/exp/exp_lh_outer/best_model_DT1.pth
[2026-01-20 22:01:22,523][__main__][INFO] - checkpoint saved to /public_bme2/bme-dgshen/caoshui2024/DP_Project/CorticalFlow++/exp/exp_lh_outer/checkpoints/model_DT1_ite000002.pth
[2026-01-20 22:01:28,338][__main__][INFO] - Training: deform=1, Ite=4, Losses=defaultdict(<class 'float'>, {'chamffer_points': 0.000631876231636852, 'edge_loss': 0.0001284146128455177, 'loss': 0.0007602908299304545}), AvgIteTime=93.54 secs
[2026-01-20 22:01:28,339][__main__][INFO] - Evaluating...
[2026-01-20 22:04:29,799][__main__][INFO] - Evaluation: deform=1, Ite=4, Loss=defaultdict(<class 'float'>, {'chamffer_points': 0.00020508002063895507, 'edge_loss': 3.9924404451839356e-05, 'loss': 0.0002450044224288587}), EvalTime=181.46 secs
[2026-01-20 22:04:29,826][__main__][INFO] - Best model found with chamffer_points=0.000205 !!! checkpoint to /public_bme2/bme-dgshen/caoshui2024/DP_Project/CorticalFlow++/exp/exp_lh_outer/best_model_DT1.pth
[2026-01-20 22:04:29,846][__main__][INFO] - checkpoint saved to /public_bme2/bme-dgshen/caoshui2024/DP_Project/CorticalFlow++/exp/exp_lh_outer/checkpoints/model_DT1_ite000004.pth
[2026-01-20 22:04:29,846][__main__][INFO] - Training deformation 2
[2026-01-20 22:04:29,862][__main__][INFO] - Best wights for deformation 1 loaded from /public_bme2/bme-dgshen/caoshui2024/DP_Project/CorticalFlow++/exp/exp_lh_outer/best_model_DT1.pth
[2026-01-20 22:04:29,862][__main__][INFO] - Train deform 2: number of learnable parameters: 111171/325737
[2026-01-20 22:04:29,863][__main__][INFO] - Train deform 2: Optimizer setup:
Adam (
Parameter Group 0
    amsgrad: False
    betas: (0.9, 0.999)
    capturable: False
    differentiable: False
    eps: 1e-08
    foreach: None
    fused: None
    lr: 0.0001
    maximize: False
    weight_decay: 0
)
[2026-01-20 22:04:29,863][__main__][INFO] - Starting train deformation 2 from 1 iterations with best validation loss of 3.4028234663852886e+38
[2026-01-20 22:04:36,885][__main__][INFO] - Training: deform=2, Ite=2, Losses=defaultdict(<class 'float'>, {'chamffer_points': 0.0006662808591499925, 'edge_loss': 0.00012403524306137115, 'loss': 0.0007903161167632788}), AvgIteTime=3.51 secs
[2026-01-20 22:04:36,887][__main__][INFO] - Evaluating...
[2026-01-20 22:07:39,705][__main__][INFO] - Evaluation: deform=2, Ite=2, Loss=defaultdict(<class 'float'>, {'chamffer_points': 0.0002050854275627743, 'edge_loss': 3.99242142121671e-05, 'loss': 0.0002450096455016514}), EvalTime=182.82 secs
[2026-01-20 22:07:39,730][__main__][INFO] - Best model found with chamffer_points=0.000205 !!! checkpoint to /public_bme2/bme-dgshen/caoshui2024/DP_Project/CorticalFlow++/exp/exp_lh_outer/best_model_DT2.pth
[2026-01-20 22:07:39,750][__main__][INFO] - checkpoint saved to /public_bme2/bme-dgshen/caoshui2024/DP_Project/CorticalFlow++/exp/exp_lh_outer/checkpoints/model_DT2_ite000002.pth
[2026-01-20 22:07:46,411][__main__][INFO] - Training: deform=2, Ite=4, Losses=defaultdict(<class 'float'>, {'chamffer_points': 0.0006435942486859858, 'edge_loss': 0.00012426665489329025, 'loss': 0.0007678609108552337}), AvgIteTime=94.76 secs
[2026-01-20 22:07:46,412][__main__][INFO] - Evaluating...
[2026-01-20 22:10:47,408][__main__][INFO] - Evaluation: deform=2, Ite=4, Loss=defaultdict(<class 'float'>, {'chamffer_points': 0.00020499515954813943, 'edge_loss': 3.9923987592706775e-05, 'loss': 0.00024491914678592143}), EvalTime=181.00 secs
[2026-01-20 22:10:47,435][__main__][INFO] - Best model found with chamffer_points=0.000205 !!! checkpoint to /public_bme2/bme-dgshen/caoshui2024/DP_Project/CorticalFlow++/exp/exp_lh_outer/best_model_DT2.pth
[2026-01-20 22:10:47,456][__main__][INFO] - checkpoint saved to /public_bme2/bme-dgshen/caoshui2024/DP_Project/CorticalFlow++/exp/exp_lh_outer/checkpoints/model_DT2_ite000004.pth
[2026-01-20 22:10:47,456][__main__][INFO] - Training finished.
